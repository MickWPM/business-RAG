<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAG Evaluation Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Inter', sans-serif;
        }
        .metric-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .progress-bar-bg {
            background-color: #e5e7eb;
        }
        .progress-bar {
            transition: width 0.5s ease-in-out;
        }
        /* Tooltip Styles */
        .tooltip-container {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        #global-tooltip {
            visibility: hidden;
            width: 320px;
            background-color: #1f2937; /* bg-gray-800 */
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 8px 12px;
            position: fixed; /* Use fixed positioning */
            z-index: 9999; /* Ensure it's on top of everything */
            opacity: 0;
            transition: opacity 0.2s;
            font-size: 0.875rem; /* text-sm */
            line-height: 1.4;
            font-weight: 400; /* font-normal */
            white-space: normal;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            pointer-events: none; /* Prevent tooltip from blocking mouse events */
        }
        
        /* Detail Row Styles */
        .detail-row {
            display: none; /* Hidden by default */
        }
        .detail-cell {
            background-color: #f9fafb; /* bg-gray-50 */
            padding: 16px;
            border-bottom: 1px solid #e5e7eb; /* border-gray-200 */
        }
        .detail-cell h5 {
            font-weight: 600; /* font-semibold */
            margin-bottom: 8px;
            color: #4b5563; /* text-gray-600 */
        }
        .detail-cell pre {
            background-color: #f3f4f6; /* bg-gray-100 */
            padding: 12px;
            border-radius: 6px;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 0.875rem;
            line-height: 1.5;
            color: #374151; /* text-gray-700 */
        }
        /* Sticky Header Style */
        .sticky-header th {
            position: sticky;
            top: 0;
            background-color: #f9fafb; /* bg-gray-50 */
            box-shadow: 0 2px 2px -1px rgba(0, 0, 0, 0.1);
            z-index: 5;
        }
        /* Filter Button Styles */
        .filter-btn {
            transition: all 0.2s ease-in-out;
        }
        .filter-btn.active {
            background-color: #4f46e5; /* bg-indigo-600 */
            color: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-900">RAG Evaluation Dashboard</h1>
            <p class="text-lg text-gray-600 mt-2">Visualize the performance of your Retrieval-Augmented Generation system.</p>
        </header>

        <main>
            <!-- Input Section -->
            <div id="input-section" class="bg-white p-6 rounded-xl shadow-md mb-8">
                <h2 class="text-2xl font-semibold mb-4">1. Load Your Data</h2>
                <label for="json-input" class="block text-sm font-medium text-gray-700 mb-2">Paste the contents of your `rag_test_results.json` file below:</label>
                <textarea id="json-input" rows="10" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"></textarea>
                <button id="generate-dashboard" class="mt-4 w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform transform hover:scale-105">
                    Generate Dashboard
                </button>
            </div>

            <!-- Dashboard Display Area -->
            <div id="dashboard-output" class="hidden">
                
                <!-- Overall Performance -->
                <section id="overall-performance" class="mb-12">
                    <h2 class="text-3xl font-bold mb-6 border-b pb-2 flex justify-between items-center">
                        <span>Overall Performance</span>
                        <span id="total-cases-badge" class="text-lg font-semibold bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full"></span>
                    </h2>
                    <div id="overall-summary" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-6">
                        <!-- Metric cards will be inserted here -->
                    </div>
                </section>

                <!-- Performance by Query Type -->
                <section id="categorized-performance" class="mb-12">
                    <h2 class="text-3xl font-bold mb-6 border-b pb-2">Performance by Query Type</h2>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div id="simple-query-summary">
                            <h3 class="text-2xl font-semibold mb-4 text-center">Simple Queries</h3>
                            <div id="simple-metrics" class="space-y-4"></div>
                        </div>
                        <div id="complex-query-summary">
                            <h3 class="text-2xl font-semibold mb-4 text-center">Complex Queries</h3>
                            <div id="complex-metrics" class="space-y-4"></div>
                        </div>
                    </div>
                </section>

                <!-- Key Insights & Issues Section -->
                <section id="key-insights" class="mb-12">
                    <h2 class="text-3xl font-bold mb-6 border-b pb-2">Key Insights & Issues</h2>
                    <div id="insights-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Insight cards will be inserted here -->
                    </div>
                </section>

                <!-- Detailed Results Table -->
                <section id="detailed-results">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-3xl font-bold border-b pb-2">Detailed Results</h2>
                        <div id="filter-container" class="flex space-x-2 bg-gray-200 p-1 rounded-lg">
                           <!-- Filter buttons will be inserted here -->
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-md overflow-auto" style="max-height: 80vh;">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="sticky-header">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Question</th>
                                    <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Doc Recall</th>
                                    <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Context Rel.</th>
                                    <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Faithfulness</th>
                                    <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Correctness</th>
                                    <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Answer Rel.</th>
                                </tr>
                            </thead>
                            <tbody id="results-table-body" class="bg-white divide-y divide-gray-200">
                                <!-- Table rows will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
             <!-- Error Message -->
            <div id="error-message" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg relative" role="alert">
                <strong class="font-bold">Error:</strong>
                <span class="block sm:inline" id="error-text"></span>
            </div>
        </main>
    </div>

    <!-- Global Tooltip -->
    <div id="global-tooltip"></div>

    <script>
        document.getElementById('generate-dashboard').addEventListener('click', () => {
            const jsonInput = document.getElementById('json-input').value;
            const outputDiv = document.getElementById('dashboard-output');
            const errorDiv = document.getElementById('error-message');
            const errorText = document.getElementById('error-text');
            const inputSection = document.getElementById('input-section');

            if (!jsonInput.trim()) {
                errorText.textContent = "Please paste your JSON data into the text area.";
                errorDiv.classList.remove('hidden');
                outputDiv.classList.add('hidden');
                return;
            }

            try {
                const data = JSON.parse(jsonInput);
                errorDiv.classList.add('hidden');
                outputDiv.classList.remove('hidden');
                inputSection.style.display = 'none'; // Hide the input section
                renderDashboard(data);
            } catch (e) {
                errorText.textContent = "Invalid JSON format. Please check your data and try again. " + e.message;
                errorDiv.classList.remove('hidden');
                outputDiv.classList.add('hidden');
            }
        });

        function renderDashboard(data) {
            // Define categories
            const simpleTypes = ["SIMPLE_RETRIEVAL", "LIST_EXTRACTION"];
            const complexTypes = ["SYNTHESIS", "CHAINED_RETRIEVAL"];

            // --- Calculate Metrics ---
            const metrics = {
                overall: { c: 0, r: 0, f: 0, recall: 0, context: 0, unanswerable_correct: 0, count: 0, llm_count: 0, unanswerable_count: 0 },
                simple:  { c: 0, r: 0, f: 0, recall: 0, context: 0, unanswerable_correct: 0, count: 0, llm_count: 0, unanswerable_count: 0 },
                complex: { c: 0, r: 0, f: 0, recall: 0, context: 0, unanswerable_correct: 0, count: 0, llm_count: 0, unanswerable_count: 0 }
            };

            data.forEach(result => {
                const scores = result.evaluation_scores;
                if (!scores) return;

                const qType = result.question_type;
                const category = simpleTypes.includes(qType) ? 'simple' : complexTypes.includes(qType) ? 'complex' : null;

                metrics.overall.count++;
                if (category) metrics[category].count++;

                metrics.overall.recall += scores.retrieval_recall || 0;
                if (category) metrics[category].recall += scores.retrieval_recall || 0;
                
                if (qType === "UNANSWERABLE") {
                    metrics.overall.unanswerable_count++;
                    if (category) metrics[category].unanswerable_count++;
                    const correctlyHandled = result.generated_answer.toLowerCase().includes("don't have enough information") || result.generated_answer.toLowerCase().includes("cannot answer");
                    if (correctlyHandled) {
                        metrics.overall.unanswerable_correct++;
                        if (category) metrics[category].unanswerable_correct++;
                    }
                } else if (scores.correctness_score !== undefined) {
                    metrics.overall.llm_count++;
                    metrics.overall.c += scores.correctness_score || 0;
                    metrics.overall.r += scores.answer_relevance_score || 0;
                    metrics.overall.f += scores.faithfulness_score || 0;
                    metrics.overall.context += scores.context_relevance_score || 0;
                    if (category) {
                        metrics[category].llm_count++;
                        metrics[category].c += scores.correctness_score || 0;
                        metrics[category].r += scores.answer_relevance_score || 0;
                        metrics[category].f += scores.faithfulness_score || 0;
                        metrics[category].context += scores.context_relevance_score || 0;
                    }
                }
            });

            // --- Render Components ---
            document.getElementById('total-cases-badge').textContent = `${data.length} Test Cases`;
            renderOverallSummary(metrics.overall);
            renderCategorizedSummary('simple', metrics.simple);
            renderCategorizedSummary('complex', metrics.complex);
            renderKeyInsights(data);
            renderDetailedTable(data);
            setupFilters(data, simpleTypes, complexTypes);
        }

        function createMetricCard(title, value, isPercentage = false) {
            const displayValue = isPercentage ? `${(value * 100).toFixed(1)}%` : `${value.toFixed(2)}/5`;
            const color = value >= (isPercentage ? 0.9 : 4.5) ? 'green' : value >= (isPercentage ? 0.7 : 3.5) ? 'yellow' : 'red';
            
            return `
                <div class="metric-card bg-white p-6 rounded-xl shadow-md text-center">
                    <h4 class="text-lg font-semibold text-gray-600">${title}</h4>
                    <p class="text-4xl font-bold text-${color}-600 mt-2">${displayValue}</p>
                </div>
            `;
        }

        function renderOverallSummary(overallMetrics) {
            const summaryContainer = document.getElementById('overall-summary');
            summaryContainer.innerHTML = '';
            
            if (overallMetrics.count > 0) {
                summaryContainer.innerHTML += createMetricCard('Document Recall', overallMetrics.recall / overallMetrics.count, true);
            }
            if (overallMetrics.unanswerable_count > 0) {
                summaryContainer.innerHTML += createMetricCard('Unanswerable Acc.', overallMetrics.unanswerable_correct / overallMetrics.unanswerable_count, true);
            }
            if (overallMetrics.llm_count > 0) {
                summaryContainer.innerHTML += createMetricCard('Context Relevance', overallMetrics.context / overallMetrics.llm_count);
                summaryContainer.innerHTML += createMetricCard('Faithfulness', overallMetrics.f / overallMetrics.llm_count);
                summaryContainer.innerHTML += createMetricCard('Correctness', overallMetrics.c / overallMetrics.llm_count);
                summaryContainer.innerHTML += createMetricCard('Answer Relevance', overallMetrics.r / overallMetrics.llm_count);
            }
        }

        function createProgressBar(title, value, isPercentage = false) {
            let displayValue, widthPercentage, colorValue;

            if (isPercentage) {
                displayValue = `${(value * 100).toFixed(1)}%`;
                widthPercentage = value * 100;
                colorValue = value;
            } else {
                // Convert 1-5 score to a percentage for display
                const percentage = (value / 5) * 100;
                displayValue = `${percentage.toFixed(1)}%`;
                widthPercentage = percentage;
                colorValue = value / 5; // Normalized 0-1 for color
            }
            
            const color = colorValue >= 0.9 ? 'bg-green-500' : colorValue >= 0.7 ? 'bg-yellow-500' : 'bg-red-500';

            return `
                <div class="bg-white p-4 rounded-xl shadow-md">
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-md font-medium text-gray-700">${title}</span>
                        <span class="text-sm font-semibold text-gray-900">${displayValue}</span>
                    </div>
                    <div class="w-full progress-bar-bg rounded-full h-4">
                        <div class="progress-bar ${color} h-4 rounded-full" style="width: ${widthPercentage}%"></div>
                    </div>
                </div>
            `;
        }

        function renderCategorizedSummary(category, catMetrics) {
            const container = document.getElementById(`${category}-metrics`);
            container.innerHTML = '';
            
            if (catMetrics.count === 0) {
                 container.innerHTML = '<p class="text-center text-gray-500">No data for this category.</p>';
                 return;
            }
            
            container.innerHTML += createProgressBar('Document Recall', catMetrics.recall / catMetrics.count, true);
            if (catMetrics.unanswerable_count > 0) {
                container.innerHTML += createProgressBar('Unanswerable Acc.', catMetrics.unanswerable_correct / catMetrics.unanswerable_count, true);
            }
            if (catMetrics.llm_count > 0) {
                container.innerHTML += createProgressBar('Context Relevance', catMetrics.context / catMetrics.llm_count);
                container.innerHTML += createProgressBar('Faithfulness', catMetrics.f / catMetrics.llm_count);
                container.innerHTML += createProgressBar('Correctness', catMetrics.c / catMetrics.llm_count);
                container.innerHTML += createProgressBar('Answer Relevance', catMetrics.r / catMetrics.llm_count);
            }
        }
        
        function createInsightCard(title, id, reason, scores, targetId) {
            return `
                <a href="#${targetId}" class="block bg-white p-6 rounded-xl shadow-md border-l-4 border-red-500 hover:shadow-lg transition">
                    <h4 class="text-lg font-bold text-red-700">${title}</h4>
                    <p class="text-sm font-medium text-gray-800 mt-1">Question ID: <span class="font-mono bg-gray-100 p-1 rounded">${id}</span></p>
                    <p class="text-gray-600 mt-2">${reason}</p>
                    <div class="mt-3 text-xs font-semibold text-gray-500">
                        <span>Recall: ${(scores.retrieval_recall * 100).toFixed(0)}%</span> |
                        <span>Context: ${scores.context_relevance_score || 'N/A'}</span> |
                        <span>Faithful: ${scores.faithfulness_score || 'N/A'}</span> |
                        <span>Correct: ${scores.correctness_score || 'N/A'}</span>
                    </div>
                </a>
            `;
        }
        
        function renderKeyInsights(data) {
            const insightsContainer = document.getElementById('insights-container');
            insightsContainer.innerHTML = '';
            let insightsFound = false;

            data.forEach((result, index) => {
                const scores = result.evaluation_scores;
                if (!scores) return;

                const targetId = `row-${index}`;

                if (scores.retrieval_recall === 0) {
                    insightsFound = true;
                    insightsContainer.innerHTML += createInsightCard('Retrieval Failure', result.question_id, 'The system failed to retrieve any of the correct documents for this question.', scores, targetId);
                }
                
                const isPoorFaithfulness = scores.faithfulness_score <= 2;
                const isPoorCorrectness = scores.correctness_score <= 2;
                if(isPoorFaithfulness || isPoorCorrectness) {
                    insightsFound = true;
                    insightsContainer.innerHTML += createInsightCard('Poor Generation Quality', result.question_id, `The generated answer scored low on ${isPoorFaithfulness ? 'Faithfulness' : ''} ${isPoorCorrectness ? 'Correctness' : ''}.`, scores, targetId);
                }

                const isGoodContext = scores.context_relevance_score >= 4;
                if(isGoodContext && isPoorCorrectness) {
                     insightsFound = true;
                    insightsContainer.innerHTML += createInsightCard('Synthesis Failure', result.question_id, 'The system found the right info but failed to generate a correct answer.', scores, targetId);
                }
            });

            if (!insightsFound) {
                insightsContainer.innerHTML = `<div class="col-span-full text-center bg-green-100 text-green-800 p-4 rounded-lg"><p class="font-semibold">No significant issues found based on the defined criteria. Great work!</p></div>`;
            }
        }

        function createScoreCell(score, justification) {
            return `<div class="tooltip-container" data-justification="${justification || 'No justification provided.'}"><span>${score}</span></div>`;
        }

        function renderDetailedTable(data) {
            const tableBody = document.getElementById('results-table-body');
            tableBody.innerHTML = '';
            let hoverTimeout;

            data.forEach((result, index) => {
                const scores = result.evaluation_scores || {};
                const recall = scores.retrieval_recall;
                const displayRecall = typeof recall === 'number' ? `${(recall * 100).toFixed(0)}%` : 'N/A';
                
                let mainRow = document.createElement('tr');
                mainRow.id = `row-${index}`;
                mainRow.className = 'hover:bg-gray-100 transition-colors';
                mainRow.dataset.queryType = result.question_type;

                let rowHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${result.question_id}</td>
                    <td class="px-6 py-4 whitespace-normal text-sm text-gray-700">${result.question_text}</td>
                    <td class="px-6 py-4 text-center text-sm font-semibold">${displayRecall}</td>`;

                if (result.question_type === 'UNANSWERABLE') {
                    const correctlyHandled = result.generated_answer.toLowerCase().includes("don't have enough information") || result.generated_answer.toLowerCase().includes("cannot answer");
                    const justification = `System ${correctlyHandled ? 'correctly identified the question as unanswerable.' : 'failed by attempting to generate an answer.'}`;
                    const display = `<span class="font-bold ${correctlyHandled ? 'text-green-600' : 'text-red-600'}">${correctlyHandled ? '✅ 5' : '❌ 1'}</span>`;
                    
                    rowHTML += `
                        <td class="px-6 py-4 text-center text-sm text-gray-500">N/A</td>
                        <td class="px-6 py-4 text-center text-sm text-gray-500">N/A</td>
                        <td class="px-6 py-4 text-center text-sm">${createScoreCell(display, justification)}</td>
                        <td class="px-6 py-4 text-center text-sm text-gray-500">N/A</td>`;
                } else {
                    rowHTML += `<td class="px-6 py-4 text-center text-sm font-semibold">${createScoreCell(scores.context_relevance_score, scores.context_relevance_justification)}</td>`;
                    rowHTML += `<td class="px-6 py-4 text-center text-sm font-semibold">${createScoreCell(scores.faithfulness_score, scores.faithfulness_justification)}</td>`;
                    rowHTML += `<td class="px-6 py-4 text-center text-sm font-semibold">${createScoreCell(scores.correctness_score, scores.correctness_justification)}</td>`;
                    rowHTML += `<td class="px-6 py-4 text-center text-sm font-semibold">${createScoreCell(scores.answer_relevance_score, scores.answer_relevance_justification)}</td>`;
                }
                
                mainRow.innerHTML = rowHTML;
                tableBody.appendChild(mainRow);

                // Create the hidden detail row
                let detailRow = document.createElement('tr');
                detailRow.className = 'detail-row';
                detailRow.innerHTML = `
                    <td colspan="7" class="detail-cell">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h5>Ground Truth</h5>
                                <pre class="mb-2"><strong>Q:</strong> ${result.question_text}</pre>
                                <pre>${result.ground_truth_answer}</pre>
                            </div>
                            <div>
                                <h5>Generated Answer</h5>
                                <pre>${result.generated_answer}</pre>
                            </div>
                        </div>
                    </td>
                `;
                tableBody.appendChild(detailRow);
                
                const scoreCells = mainRow.querySelectorAll('.tooltip-container');
                
                scoreCells.forEach(cell => {
                    cell.addEventListener('mouseenter', () => {
                        clearTimeout(hoverTimeout);
                        hoverTimeout = setTimeout(() => {
                            document.querySelectorAll('.detail-row').forEach(r => {
                                if (r !== detailRow) r.style.display = 'none';
                            });
                            detailRow.style.display = 'table-row';
                        }, 300);
                    });
                });

                const hideDetailRow = () => {
                    clearTimeout(hoverTimeout);
                    detailRow.style.display = 'none';
                };

                mainRow.addEventListener('mouseleave', (event) => {
                    if (event.relatedTarget !== detailRow && !detailRow.contains(event.relatedTarget)) {
                        hideDetailRow();
                    }
                });
                
                detailRow.addEventListener('mouseleave', (event) => {
                     if (event.relatedTarget !== mainRow && !mainRow.contains(event.relatedTarget)) {
                        hideDetailRow();
                    }
                });
            });
            
            // Setup global tooltip listeners after table is rendered
            setupGlobalTooltip();
        }

        function setupFilters(data, simpleTypes, complexTypes) {
            const filterContainer = document.getElementById('filter-container');
            const filters = ['All', 'Simple', 'Complex', 'Unanswerable'];
            filterContainer.innerHTML = ''; // Clear existing

            filters.forEach(filter => {
                const button = document.createElement('button');
                button.textContent = filter;
                button.className = 'filter-btn px-3 py-1 text-sm font-medium text-gray-600 rounded-md hover:bg-gray-300';
                if (filter === 'All') button.classList.add('active');
                
                button.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    filterTable(filter, simpleTypes, complexTypes);
                });
                filterContainer.appendChild(button);
            });
        }

        function filterTable(filter, simpleTypes, complexTypes) {
            const rows = document.querySelectorAll('#results-table-body tr:not(.detail-row)');
            rows.forEach(row => {
                const type = row.dataset.queryType;
                let show = false;
                if (filter === 'All') {
                    show = true;
                } else if (filter === 'Simple' && simpleTypes.includes(type)) {
                    show = true;
                } else if (filter === 'Complex' && complexTypes.includes(type)) {
                    show = true;
                } else if (filter === 'Unanswerable' && type === 'UNANSWERABLE') {
                    show = true;
                }
                
                row.style.display = show ? '' : 'none';
                // Also hide its associated detail row
                const detailRow = row.nextElementSibling;
                if (detailRow && detailRow.classList.contains('detail-row')) {
                    detailRow.style.display = 'none';
                }
            });
        }

        function setupGlobalTooltip() {
            const tooltipEl = document.getElementById('global-tooltip');
            document.querySelectorAll('.tooltip-container').forEach(container => {
                container.addEventListener('mouseenter', (e) => {
                    const justification = e.currentTarget.dataset.justification;
                    tooltipEl.innerHTML = justification;
                    
                    const rect = e.currentTarget.getBoundingClientRect();
                    
                    // Position tooltip above the element
                    let top = rect.top - tooltipEl.offsetHeight - 8;
                    let left = rect.left + (rect.width / 2) - (tooltipEl.offsetWidth / 2);

                    // Adjust if it goes off-screen
                    if (left < 8) left = 8;
                    if (left + tooltipEl.offsetWidth > window.innerWidth - 8) {
                        left = window.innerWidth - tooltipEl.offsetWidth - 8;
                    }
                    if (top < 8) { // If it goes off the top, position it below
                        top = rect.bottom + 8;
                    }

                    tooltipEl.style.left = `${left}px`;
                    tooltipEl.style.top = `${top}px`;
                    tooltipEl.style.visibility = 'visible';
                    tooltipEl.style.opacity = '1';
                });

                container.addEventListener('mouseleave', () => {
                    tooltipEl.style.visibility = 'hidden';
                    tooltipEl.style.opacity = '0';
                });
            });
        }

    </script>
</body>
</html>
